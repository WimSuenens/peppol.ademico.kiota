# Peppol C# SDK

- The SDK is generated by Kiota on top of the [Ademico API](https://ademico-software.com/peppol/peppol-service-provider/).
- Ademico itself is not involved in this project and they therefore bear no responsibility for the compatibility with new versions of their API.
- However, to use the SDK, you'll need to obtain a license key from Ademico. They will charge you according to their pricing policy.
- This SDK project itself is open source under the MIT License.

## Setup

To get started set your Ademico ClientId and ClientSercet in your environment variables.

```.env
Ademico__Client__Id=YOUR_ADEMICO_CLIENT_ID
Ademico__Client__Secret=YOUR_ADEMICO_CLIENT_SECRET
```

In your appsettings.json, set the correct url for the `TokenEndpoint` as well as the `ApiBaseUrl`.

```json
# appsettings.json
{
    "Ademico" : {
        "TokenEndpoint": "https://test-peppol-oauth2.ademico-software.com/oauth2/token",
        "ApiBaseUrl": "https://test-peppol-api.ademico-software.com",
        "Client": {
            "Id": "Use an environment variable 'Ademico__Client__Id'",
            "Secret": "Use an environment variable 'Ademico__Client__Secret'"
        }
  }
}
```

Call the extension method `AddPeppolServices` provided by the SDK and get started.

```cs
var builder = WebApplication.CreateBuilder(args);
// ...
builder.Services.AddPeppolServices(builder.Configuration);
// ...
```

You need to take into consideration the Ademico API has a rate limiter built in.
The authentication endpoint can only be called a few times per hour. But as your access token remains valid for a period of one hour, this should suffise. However in a developement environment you'll loose the application state and therefore also your access token at a restart. To bypass having the re-authenticate, use a `AccessTokenPath` in your appsettings.json referring to a `.txt` file, to store the access token locally. Doing so, the current access token will first load the value through this local path. It's adviced to only use this path for your development environment.

```json
# appsettings.json
{
    "Ademico" : {
        "TokenEndpoint": "https://test-peppol-oauth2.ademico-software.com/oauth2/token",
        "ApiBaseUrl": "https://test-peppol-api.ademico-software.com",
        "AccessTokenPath": "/tmp/AdemicoAccesToken.txt"
    }
}
```

## CI/CD Pipeline

This repository includes an automated CI/CD pipeline that publishes NuGet packages when pull requests are merged to the main branch.

### Setup Requirements

To enable automated publishing, you need to configure GitHub Secrets:

- **[GitHub Secrets Setup Guide](docs/github-secrets-setup.md)** - Complete setup instructions
- **[Quick Reference](docs/secrets-quick-reference.md)** - Quick setup checklist

### How It Works

1. When a PR is merged to main, the workflow automatically:
   - Increments the package version based on commit messages
   - Builds and tests the package
   - Publishes to nuget.org
   - Creates a git tag with the new version

2. Version increment rules:
   - **Patch** (default): Regular commits
   - **Minor**: Commits with `feat:` prefix or `enhancement` PR label
   - **Major**: Commits with `BREAKING CHANGE:` or `breaking-change` PR label

## Usage

To call the API, inject the `PeppolAdemicoApiClient` through dependency injection into your services.

```cs
public interface IAdemicoService
{
    Task TestConnectivityAsync(CancellationToken token = default);
}

public class AdemicoService(PeppolAdemicoApiClient _client) : IAdemicoService
{
    public async Task TestConnectivityAsync(CancellationToken token = default)
    {
        await _client.Api.Peppol.V1.Tools.Connectivity.GetAsync(cancellationToken: token);
    }    
}
```
